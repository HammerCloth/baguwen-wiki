<!--yml
category: 未分类
date: 0001-01-01 00:00:00
-->

# 1229.如何确保消息不丢失？

> 原文：[https://zwmst.com/5764.html](https://zwmst.com/5764.html)

   [ *RabbitMQ* ](https://zwmst.com/rabbitmq)*[ <time datetime="2021-10-31T05:50:17+08:00"> 2021-10-30 </time> ](https://zwmst.com/5764.html)  消息持久化的前提是：将交换器/队列的durable属性设置为true，表示交换器/队列是持久交换器/队列，在服务器崩溃或重启之后不需要重新创建交换器/队列（交换器/队列会⾃动创建）。
如果消息想要从Rabbit崩溃中恢复，那么消息必须：

1.  在消息发布前，通过把它的 “投递模式” 选项设置为2（持久）来把消息标记成持久化
2.  将消息发送到持久交换器
3.  消息到达持久队列

    RabbitMQ确保持久性消息能从服务器重启中恢复的⽅式是，将它们写⼊磁盘上的⼀个持久化⽇志⽂件，当发布⼀条持久性消息到持久交换器上时，Rabbit会在消息提交到⽇志⽂件后才发送响应（如果消息路由到了⾮持久队列，它会⾃动从持久化⽇志中移除）。⼀旦消费者从持久队列中消费了⼀条持久化消息，RabbitMQ会在持久化⽇志中把这条消息标记为等待垃圾收集。如果持久化消息在被消费之前RabbitMQ重启，那么Rabbit会⾃动重建交换器和队列（以及绑定），并重播持久化⽇志⽂件中的消息到合适的队列或者交换器上。*