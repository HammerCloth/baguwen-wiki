<!--yml
category: 未分类
date: 0001-01-01 00:00:00
--->

# 434.四层负载均衡（目标地址和端口交换）

> 原文：[https://zwmst.com/3930.html](https://zwmst.com/3930.html)

   [ *微服务* ](https://zwmst.com/%e5%be%ae%e6%9c%8d%e5%8a%a1)*[ <time datetime="2021-09-24T15:42:39+08:00"> 2021-09-24 </time> ](https://zwmst.com/3930.html)  主要通过报文中的目标地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。
以常见的 TCP 为例，**负载均衡设备在接收到第一个来自客户端的 SYN 请求时，即通过上述方式选择一个最佳的服务器，并对报文中目标 IP 地址进行修改(改为后端服务器 IP），直接转发给该服务器**。TCP 的连接建立，**即三次握手是客户端和服务器直接建立的，负载均衡设备只是起到一个类似路由器的转发动作**。在某些部署情况下，为保证服务器回包可以正确返回给负载均衡设备，在转发报文的同时可能还会对报文原来的源地址进行修改。实现四层负载均衡的软件有：

**F5：硬件负载均衡器，功能很好，但是成本很高。
lvs：重量级的四层负载软件。
nginx：轻量级的四层负载软件，带缓存功能，正则表达式较灵活。
haproxy：模拟四层转发，较灵活**。*