<!--yml
category: 未分类
date: 0001-01-01 00:00:00
-->

# Netty 的心跳机制了解么？

> 原文：[https://zwmst.com/752.html](https://zwmst.com/752.html)

   [ *Netty* ](https://zwmst.com/netty)*[ <time datetime="2021-08-14T08:03:07+08:00"> 2021-08-14 </time> ](https://zwmst.com/752.html)  在 TCP 保持长连接的过程中，可能会出现断网等网络异常出现，异常发生的时候， client 与 server 之间如果没有交互的话，它们是无法发现对方已经掉线的。为了解决这个问题, 我们就 需要引入 心跳机制。

心跳机制的工作原理是: 在 client 与 server 之间在一定时间内没有数据交互时, 即处于 idle 状 态时, 客户端或服务器就会发送一个特殊的数据包给对方, 当接收方收到这个数据报文后, 也立 即发送一个特殊的数据报文, 回应发送方, 此即一个 PING-PONG 交互。所以, 当某一端收到心 跳消息后, 就知道了对方仍然在线, 这就确保 TCP 连接的有效性.

TCP 实际上自带的就有长连接选项，本身是也有心跳包机制，也就是 TCP 的选项： SO_KEEPALIVE。但是，TCP 协议层面的长连接灵活性不够。所以，一般情况下我们都是在 应用层协议上实现自定义心跳机制的，也就是在 Netty 层面通过编码实现。通过 Netty 实现心 跳机制的话，核心类是 IdleStateHandler 。*