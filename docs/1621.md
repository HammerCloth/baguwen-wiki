<!--yml
category: 未分类
date: 0001-01-01 00:00:00
--->

# 268.两阶段提交

> 原文：[https://zwmst.com/3524.html](https://zwmst.com/3524.html)

   [ *Spring* ](https://zwmst.com/spring)*[ <time datetime="2021-09-19T21:00:05+08:00"> 2021-09-19 </time> ](https://zwmst.com/3524.html)  两阶段提交主要保证了分布式事务的原子性：即所有结点要么全做要么全不做，所谓的两个阶段是指：**第一阶段：准备阶段；第二阶段：提交阶段**。

1.  准备阶段
    事务协调者(事务管理器)给每个参与者(资源管理器)发送 Prepare 消息，每个参与者要么直接返回失败(如权限验证失败)，**要么在本地执行事务，写本地的 redo 和 undo 日志，但不提交**，到达一种“万事俱备，只欠东风”的状态。

2.  提交阶段：
    如果协调者收到了参与者的失败消息或者超时，直接给每个参与者发送回滚(Rollback)消息；否则，发送提交(Commit)消息；参与者根据协调者的指令执行提交或者回滚操作，释放所有事务处理过程中使用的锁资源。(注意:**必须在最后阶段释放锁资源**)

将提交分成两阶段进行的目的很明确，就是尽可能晚地提交事务，让事务在提交前尽可能地完成
所有能完成的工作。*